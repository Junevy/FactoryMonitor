<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:FactoryMonitor.UserControls.Controls">

    <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

    <Style TargetType="{x:Type local:SideMenu}">
        <Setter Property="FocusVisualStyle" Value="{x:Null}" />

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type local:SideMenu}">
                    <ItemsControl ItemsSource="{TemplateBinding Items}">

                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel IsItemsHost="True" Orientation="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=Orientation}" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button
                                    Width="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=MenuItemWidth}"
                                    Height="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=MenuItemHeight}"
                                    Margin="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=MenuItemMargin}"
                                    Command="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=NavigateCommand, Mode=TwoWay}"
                                    CommandParameter="{Binding}">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border
                                                x:Name="ContainerBorder"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                Background="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=MenuItemBackground}"
                                                CornerRadius="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=MenuItemCornerRadius}">
                                                <Grid RenderTransformOrigin="0.5,0.5">
                                                    <Grid.RenderTransform>
                                                        <ScaleTransform x:Name="ButtonScale" ScaleX="1" ScaleY="1" />
                                                    </Grid.RenderTransform>

                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition MaxWidth="3" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <Border
                                                        x:Name="Indicator"
                                                        Grid.Column="0"
                                                        Width="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IndicatorWidth}"
                                                        Height="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IndicatorHeight}"
                                                        HorizontalAlignment="Left"
                                                        Background="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IndicatorBackground}"
                                                        CornerRadius="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IndicatorCornerRadius}"
                                                        Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                                    <ContentPresenter
                                                        Grid.Column="1"
                                                        VerticalAlignment="Center"
                                                        Content="{Binding}">
                                                        <ContentPresenter.ContentTemplate>
                                                            <DataTemplate>
                                                                <Grid>
                                                                    <StackPanel
                                                                        HorizontalAlignment="Stretch"
                                                                        VerticalAlignment="Stretch"
                                                                        Orientation="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=Orientation}">
                                                                        <TextBlock
                                                                            HorizontalAlignment="Center"
                                                                            VerticalAlignment="Center"
                                                                            Margin="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IconMargin}"
                                                                            FontFamily="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IconFontFamily}"
                                                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IconSize}"
                                                                            Foreground="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IconForeground}"
                                                                            Text="{Binding Icon}"
                                                                            Visibility="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=IconVisibility}" />

                                                                        <TextBlock
                                                                            HorizontalAlignment="Center"
                                                                            VerticalAlignment="Center"
                                                                            Margin="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=ContentMargin}"
                                                                            FontFamily="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=ContentFontFamily}"
                                                                            FontSize="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=ContentSize}"
                                                                            Foreground="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=Foreground}"
                                                                            Text="{Binding Content}"
                                                                            Visibility="{Binding RelativeSource={RelativeSource AncestorType=local:SideMenu}, Path=ContentVisibility}" />
                                                                    </StackPanel>
                                                                </Grid>
                                                            </DataTemplate>
                                                        </ContentPresenter.ContentTemplate>
                                                    </ContentPresenter>
                                                </Grid>
                                            </Border>

                                            <ControlTemplate.Triggers>
                                                <!--  点击缩放动画  -->
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Trigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation
                                                                    Storyboard.TargetName="ButtonScale"
                                                                    Storyboard.TargetProperty="ScaleX"
                                                                    To="0.5"
                                                                    Duration="0:0:0.2" />
                                                                <DoubleAnimation
                                                                    Storyboard.TargetName="ButtonScale"
                                                                    Storyboard.TargetProperty="ScaleY"
                                                                    To="0.5"
                                                                    Duration="0:0:0.2" />
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.EnterActions>
                                                    <Trigger.ExitActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation
                                                                    Storyboard.TargetName="ButtonScale"
                                                                    Storyboard.TargetProperty="ScaleX"
                                                                    To="1"
                                                                    Duration="0:0:0.2" />
                                                                <DoubleAnimation
                                                                    Storyboard.TargetName="ButtonScale"
                                                                    Storyboard.TargetProperty="ScaleY"
                                                                    To="1"
                                                                    Duration="0:0:0.2" />
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.ExitActions>
                                                </Trigger>

                                                <!--  选中高亮  -->
                                                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                    <Setter TargetName="Indicator" Property="Opacity" Value="1" />
                                                    <Setter TargetName="ContainerBorder" Property="Background" Value="{DynamicResource PressedBackground}" />
                                                </DataTrigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>

                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>   